package com.tmquan2508.exploit.commands;

import com.tmquan2508.exploit.Exploit;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;

public abstract class AbstractToggleCommand extends Command {

    public abstract Exploit.State getStateToToggle();

    public abstract String getEnabledMessage(Player target);

    public abstract String getDisabledMessage(Player target);

    public void onEnable(Player target) { }

    public void onDisable(Player target) { }

    public boolean canTargetOthers() {
        return true;
    }

    @Override
    public final void execute(Player sender, String[] args) {
        Player target = sender;

        if (args.length > 0) {
            if (!canTargetOthers()) {
                Exploit.sender.sendError(sender, "This command cannot be used on other players.");
                return;
            }
            target = Bukkit.getPlayer(args[0]);
            if (target == null) {
                Exploit.sender.sendError(sender, "Player not found: " + args[0]);
                return;
            }
        }

        boolean currentState = Exploit.getState(Exploit.playerStates, target.getName(), getStateToToggle());
        boolean newState = !currentState;

        Exploit.setState(Exploit.playerStates, target.getName(), getStateToToggle(), newState);

        if (newState) {
            onEnable(target);
            Exploit.sender.sendSuccess(sender, getEnabledMessage(target));
        } else {
            onDisable(target);
            Exploit.sender.sendWarn(sender, getDisabledMessage(target));
        }
    }
}